##### ==============================
#####  OH-MY-TMUX (friendly tmux)
#####  Project config (clean build)
##### ==============================

##### --- Core ---
set -g default-terminal "screen-256color"
set -g history-limit 100000
set -sg escape-time 10

# Truecolor fallback for common TERM values
set -ga terminal-overrides ",xterm-256color:Tc,screen-256color:Tc"

##### --- Prefix (C-a) ---
unbind C-b
set -g prefix C-a
bind C-a send-prefix
# Keep C-b as an alternative/nested prefix helper
bind C-b send-prefix

##### --- Mouse ---
set -g mouse on

##### --- Titles / Renames (stability over “smart” defaults) ---
# Do not let tmux or shells rename windows/titles unexpectedly
set -g automatic-rename off
set -g allow-rename off
set -g set-titles off
set -g set-titles-string ""

##### --- Splits ---
unbind '"'
unbind %
bind | split-window -h
bind - split-window -v

##### --- Pane borders with titles (Pane = role) ---
set -g pane-border-status top
set -g pane-border-format " #{pane_title} "
# set -g pane-active-border-format " #{pane_title} "

# Rename pane role (short-lived, local context)
bind t command-prompt -p "Pane role:" "select-pane -T '%%'"
# Quick role from current directory
bind T select-pane -T "#{b:pane_current_path}"

##### --- Pane navigation (vim-style) ---
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

##### --- Resize panes quickly ---
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

##### --- Copy mode (vi) ---
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

##### --- Windows (Window = working context) ---
# Window tabs (Window name is the primary navigation unit)
setw -g window-status-separator " "
setw -g window-status-format "  #I:#W  "
setw -g window-status-current-format "#[bold,underline]  #I:#W  #[default]"
bind S command-prompt -p "SSH host (for window name):" "new-window -n 'ssh:%%' 'ssh %%'"

# Default tmux new-window remains on prefix + c
# Provide an “opinionated” window creation that names the tab by directory
bind C new-window -c "#{pane_current_path}" -n "#{b:pane_current_path}"

# Quick rename current window to current directory
bind N rename-window "#{b:pane_current_path}"

##### --- Reload config ---
bind r source-file ~/.tmux.conf \; display-message "Reloaded ~/.tmux.conf"

##### ==============================
##### Status bar (IDE-like)
##### ==============================

set -g status-position bottom
set -g status-interval 3
set -g status-style "bg=default"

# Left: session + host (Session = long-lived purpose)
set -g status-left-length 80
set -g status-left "#[bold] #S #[dim]@#H "

# Right: git · load · time (compact, always useful)
set -g status-right-length 120
set -g status-right "\
#{?pane_in_mode,#[fg=yellow]COPY ,}\
#{?#{==:#{pane_current_command},ssh},#[fg=blue]SSH→#W ,}\
#[fg=magenta]󰍛 #{cpu_percentage} \
#[fg=green] %H:%M\
"

##### ==============================
##### Plugins (TPM)
##### ==============================

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'alexwforsythe/tmux-which-key'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-cpu'


# Catppuccin
set -g @catppuccin_flavor "mocha"
# Ensure tabs show window name (#W), not pane title (#T)
set -g @catppuccin_window_text "#W"
set -g @catppuccin_window_current_text "#W"

# Continuum
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

##### ==============================
##### which-key entry point (explicit)
##### ==============================

# Keep tmux defaults intact; show discoverability on demand
bind Space show-wk-menu "#{@wk_menu_root}"

##### ==============================
##### TPM bootstrap (MUST BE LAST)
##### ==============================

run '~/.tmux/plugins/tpm/tpm'

